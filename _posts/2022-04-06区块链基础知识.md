# 区块链基础知识

[以太坊源码分析](https://www.notion.so/0b7971c9ba874d10b26da1025601858a)

[DAO攻击过程](https://www.notion.so/DAO-cfab8b2eb5bf4139bcb35a34584f5fdb)

[钱包](https://www.notion.so/d10411eda0ea43d78c0a807c544df1ae)

[节点](https://www.notion.so/0a71dff69558448ca9c273c9f5c9625b)

[账户](https://www.notion.so/2576f105ff234c7ca32844a35213d1ba)

[默克尔树](https://www.notion.so/00a26a10dd5a4ae6943d6bf1c9108eb3)

[EVM](https://www.notion.so/EVM-222db14778dd4f16b3319a25af304b16)

[solidity](https://www.notion.so/solidity-85528ec2ce204ed6b3d59b65a7b1ed78)

五层

![Untitled](%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%204f1d2/Untitled.png)

每层作用

![Untitled](%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%204f1d2/Untitled%201.png)

网络层：p2p网络，点对点通信

数据层：定义以太坊的基础数据结构（区块、账户、交易等）

共识层：节点达成共识的共识机制(POW算法)

合约层：智能合约的设计

应用层：区块链应用（DAPP、交易市场、钱包）

**1.1  区块**

![Untitled](%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%204f1d2/Untitled%202.png)

两部分：区块头和区体

每个区块头包含了连接到前一个区块的parenthash和unclehash以及该块产生时生成的timestamp

区块由挖矿产生，还会记录当前的挖矿难度difficulty

以及矿工挖出区块时计算出的满足生成条件的随机数Nonce

区块体包含了打包进区块的外部交易列表以及叔块

在同一时间 内可能产生多个合法区块，但是以太坊只选择一个区块来链接到主链

剩下的区块则成了孤块。以太坊将这些孤块也链接进来，以叔块的形式存在，挖掘出叔块的矿工也能得到不同程度的奖励

**1.2 账户**

账户是以太坊中最基本的数据单位

两种：外部账号（EOA）和合约账号（Contract Account）

外部账号由用户的私钥控制，不包含代码，用户可以通过外部账户完成智能合约的部署或生成合约账户地址

合约账户包含可执行代码，但不会自主执行，需要其他外部账户或合约账户发起交易才能使其中的代码执行。

每个账户都有一个长度为20Byte的地址，外部账户的地址由用户的公钥加密产生，而合约账户的地址即为智能合约的调用地址

**1.3 交易**

交易即一个账户发出的消息

根据发送者不同可划分为外部交易和内部交易两种类型

外部账户发出的交易称为外部交易，内部账户发出的交易称为内部交易

一个外部交易触发智能合约执行后可能产生0个或多个内部交易，因为内部交易可以通过执行智能合约重现。

因此我们没法通过离线解析区块链的某个文件来获得内部交易的信息

一笔交易会携带一些关键信息，例如要发送的以太币数量、要部署的智能合约的EVM字节码、调用智能合约的参数等。

**1.4 挖矿，ETH，汽油**

挖矿是区块链达到共识的必须过程，

各节点（即矿工）将竞争解决一个难度可动态调整的数学问题，最快解开该问题的矿工可以生产一个新的区块，

将当前时间段的交易打包进区块内并链接到主链上，从而获得挖矿奖励

挖矿是区块运作的核心机制，通过挖矿才能产生区块，交易才会生效，合约才能执行

ETH（Ether，以太币）是以太坊的原生加密货币。

当开采一个区块时，挖矿者将获得 ETH 奖励。

ETH 可以在加密货币交易所中进行购买，汇率随市场价格变动。也可以通过发送交易在账户之间进
行转移。

为了方便计算，以太坊规定了 ETH 的单位机制。wei 是ETH 的最小单位，以太坊中通常使用 wei 或 ether 表示 ETH 的大小。

为了促使用户在区块链上执行尽可能简单的操作，以太坊提出了一个收费机制，对用户所执行的所有操作规定了费用，收取的费用单位为汽油（gas）

每一个操作对应不同的 gas 计费标准 ，例如执行一次加法运算需要 3 个 gas，完成一次 ETH 转账需要 21,000 gas。

gas 由 ETH 来进行支付，gas 的单价对 ETH 的汇率由市场价格决定。在发起一笔交易时，用户需要自己设置 gas 的价格，即 gas price，代表每单位 gas 的价格。

矿工在打包交易进区块时，会优先选择有着更高 gas price 的交易，以获取更高的收益，因为交易的执行费用也是矿工收入的一环。

用户还可以设置该笔交易中使用的 gas 上限，称为 gas limit。
每笔交易执行前，会向用户预收取执行费用，该费用为 gas limit 与 gas price 的乘积，即 fee = gas limit × gas price。

交易执行时，如果已消耗 gas 加起来超过了 gas limit，那么这笔交易将会停止执行并回滚状态，但是已消耗的 gas 不会返还给用户，因为交易在执行过程中已经消耗了区块链的计算资源，用户需要为此进行付费；

如果没有超出 gas limit，则将剩余的 gas 以原始的 gas price 进行兑换，返还给
用户，即实际收取的费用为 fee = gas used × gas price。